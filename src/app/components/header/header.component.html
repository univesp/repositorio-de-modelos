<div class="header">
  <div class="header__image-container">
    <img src="https://apps.univesp.br/common/colorida-positiva.svg" alt="Logo da Univesp">
  </div>
  <h1>RepositÃ³rio de Modelos</h1>
  
  <div class="header-auth-section" *ngIf="!isnoBreadCrumbsPath()">

    <!-- Se NÃƒO estiver logado: mostra botÃ£o de login -->
    <button 
      *ngIf="!isLoggedIn"
      class="login-header-button"
      (click)="goToLogin()">
        Login
    </button>

    <!-- Se estiver logado: mostra avatar do usuÃ¡rio -->
    <div *ngIf="isLoggedIn" class="user-menu">

      <button
        class="user-avatar"
        [class.has-image]="imageBlobUrl"
        [class.is-loading]="isImageLoading"
        [class.has-error]="hasImageError"
        [matMenuTriggerFor]="userMenu"
        [title]="'Logado como '+ userName">

        <!-- LOADING DA IMAGEM -->
        <div *ngIf="isImageLoading" class="image-loading">
          <div class="loading-spinner"></div>
        </div>
    
        
        <!-- IMAGEM DE PERFIL (se existir) -->
        <img 
          *ngIf="imageBlobUrl && !isImageLoading" 
          [src]="imageBlobUrl" 
          alt="Foto de perfil"
          class="avatar-image"
        >
        
        <!-- INICIAL DO NOME (se nÃ£o tiver imagem) -->
        <span *ngIf="!imageBlobUrl && !isImageLoading && !hasImageError" class="avatar-initial">
          {{ userInitial }}
        </span>

        <!-- ERRO (fallback para inicial) -->
        <span 
        *ngIf="hasImageError && !isImageLoading" 
        class="avatar-initial error-fallback">
          {{ userInitial }}
        </span>
      </button>

      <mat-menu #userMenu="matMenu" class="user-dropdown-menu">

        <button mat-menu-item (click)="goToUserProfile()">
          <mat-icon>account_circle</mat-icon>
          <span>Meu Perfil</span>
        </button>

        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Sair</span>
        </button>

      </mat-menu>

    </div>

  </div>
</div>

<!-- header.component.html - ADICIONE TEMPORARIAMENTE -->
<!--
<div *ngIf="isLoggedIn" class="test-buttons" style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: white; padding: 10px; border: 1px solid #ccc;">
  <button (click)="testTokenExpired()" style="background: orange; color: white; border: none; padding: 5px 10px; margin: 5px;">
    ðŸ§ª Testar Token Expirado
  </button>
  <button (click)="testApiError()" style="background: red; color: white; border: none; padding: 5px 10px; margin: 5px;">
    ðŸ§ª Testar Erro 401
  </button>
</div>
-->

<div class="breadcrumbs" *ngIf="breadcrumbs.length > 0 && !isnoBreadCrumbsPath()">
  <ng-container *ngFor="let crumb of breadcrumbs; let i = index; let last = last">

    <!-- Home: sempre clicÃ¡vel -->
    <a 
      *ngIf="i === 0" 
      class="breadcrumb-link breadcrumb-home" 
      [class.breadcrumb-active]="breadcrumbs.length === 1"
      (click)="onClickHome()" 
      style="cursor:pointer;">
        <mat-icon class="breadcrumb-icon" aria-hidden="false" aria-label="InÃ­cio">home</mat-icon>
        {{ crumb }}
    </a>

     <!-- Outros itens -->
     <ng-container *ngIf="i > 0">
      <span class="separator"> &gt; </span>
      <span *ngIf="last; else notLast" class="breadcrumb-active">
        {{ crumb }}
      </span>
      <ng-template #notLast>
        <a class="breadcrumb-link">
          {{ crumb }}
        </a>
      </ng-template>
    </ng-container>
  </ng-container>
</div>